{%extends "baselog.html"%}
{%block title%}Němčina{% endblock %}
{%block head%}
<link rel= "stylesheet" type= "text/css" href="{{url_for('static', filename='/stylesheets/subject.css')}}">
<link rel= "stylesheet" type= "text/css" href="{{url_for('static', filename='/stylesheets/subjects/germany.css')}}">
{%endblock%}
{%block content%}

<div id="MainDiv">
<div id="grid-container">
<div class="NAME"><b>Němčina</b></div>
<div class="grid-items first">
    <div class="scrollery">
        <div id="subclassinfo">
            <p>Třída: {{subclass.classroomname}}</p>
            <p>Progres: {{subclass.progres}}</p>
            <div id="PVerb" onclick="visibilator('PVerb','','')" style="cursor:pointer;">
                Verb/Slovesa
            </div>
        </div>
    </div>
    <div class="bsetings">
        <input type="checkbox" id="chvilkanakontrolu"> <label for="chvilkanakontrolu">dodatečný čas po odpovědi</label>
    </div>
</div>
<div class="grid-items second">

        <div class="Module" id="M1" tabindex="1" value="3" value2="4" style="background-color: rgb(115, 64, 155);">
            <p><b>1) Deutsch ist NICHT leicht!</b></p>
            <div class="child">
                <p class="L" id="L3" >Lektion 1-3</p>
            </div>                
        </div>
        <div class="Module" id="M2" tabindex="1" value="3" value2="7" style="background-color: orange;">
            <p><b>2) Hobbys und Schule</b></p>
            <div class="child">
                <p class="L" id="L4">Lektion 4</p>
                <p class="L" id="L5">Lektion 5</p>
                <p class="L" id="L6">Lektion 6</p>
            </div> 
        </div>
        <div class="Module" id="M3" tabindex="1" value="3" value2="7" style="background-color: rgb(153, 28, 126);">
            <p><b>3) Freizeit und Feiern</b></p>
            <div class="child">
                <p class="L" id="L7">Lektion 7</p>
                <p class="L" id="L8">Lektion 8</p>
                <p class="L" id="L9">Lektion 9</p>
            </div>
        </div>
        <div class="Module" id="M4" tabindex="1" value="4" value2="8" style="background-color: rgb(30, 150, 70);height:4rem;">
            <p><b>4) Essen, Einkaufen und Gesundheit</b></p>
            <div class="child">
                <p class="L" id="L10">Lektion 10</p>
                <p class="L" id="L11">Lektion 11</p>
                <p class="L" id="L12">Lektion 12</p>
            </div>
        </div>
        <div class="Module" id="M5" tabindex="1" value="3" value2="7" style="background-color: rgb(74, 101, 160);">
                <p><b>5) Module 5</b></p>
            <div class="child">
                <p class="L" id="L13">Lektion 13</p>
                <p class="L" id="L14">Lektion 14</p>
                <p class="L" id="L15">Lektion 15</p>
            </div>
        </div>

</div>
<div class="grid-items third">
    <div class="scrollery">
        <div id="DIVL3">
            <div class="DIVchild" id="gramatik" style="background-color: rgb(185, 120, 185);">
                <b class="nadpisChild">Gramatik</b>
                <div class="Material">
                    <div class="Block b11"onclick="visibilator('3','g',1)">
                        <b>Verbkonjugation im Präsens</b><br>
                        Časování sloves v přítomném čase
                    </div>
                    <div class="Block b11"onclick="visibilator('3','g',2)">
                        <b>Unbestimmte und bestimmte Artikel</b><br>
                        Neurčité a určitě členy
                    </div>
                    <div class="Block b11"onclick="visibilator('3','g',3)">
                        <b>Possessivartikel</b><br>
                        Přivlasťnovací zájmena
                    </div>
                    <div class="Block b11"onclick="visibilator('3','g',4)">
                        <b>Zeitangaben</b><br>
                        Časové údaje
                    </div>
                </div>
            </div>
            <div class="DIVchild" id="wortschatz" style="background-color: rgb(157, 101, 201);">
                <b class="nadpisChild">Wortschatz</b>
                <div class="Material">
                    {%for i,v in NJ1["lekce3"]["words"].items()%}
                    <div class="Block b12" onclick="visibilator('3','w','{{i}}')">
                        <b>{{i}}</b>
                        <div class="celkemwort">
                            {{v[0]}}
                        </div>
                    </div>
                    {%endfor%}
                    
                </div>
            </div>
            <div class="DIVchild" id="lesen" style="background-color: rgb(93, 84, 164);">
                <b class="nadpisChild">Lesen</b>
                <div class="Material">
                    <div class="Block b13" onclick="visibilator('l','1')">
                        <b>Text1</b><br>
                        Hallo Leute!
                    </div>
                    <div class="Block b13" onclick="visibilator('l','2')">
                        <b>Text2</b><br>
                        Heute habe ich nicht Geburstag.
                    </div>
                    <div class="Block b13" onclick="visibilator('l','3')">
                        <b>Text3</b><br>
                        Prag ist teuer.
                    </div>
                    <div class="Block b13" onclick="visibilator('l','4')">
                        <b>Text4</b><br>
                        Meine Familie ist groß.
                    </div>
                </div>
            </div>
            <div class="DIVchild" id="endtest" style="background-color: rgb(54, 80, 136);">
                <b class="nadpisChild">Tests</b>
            </div>
        </div>
    </div>
</div>
</div>

<!------------------------------------------------------------------------------------------------------------>
<div id="clickDisabler">
<div id="TestDiv">
    <div class="krizek" onclick="hider()" tabindex=3 style="z-index: 2;">✕</div>
    <div id="TDContent">
        <div class="task ABCD">
            <div class="questions">
                <b id="nzABCD" class="nzadani">Wählst du die (richtige) Antwort, wenigstens versuchst du es.</b><br>
                <p id="czABCD" class="czadani">Vyber (správnou) odpověď, alespoň to zkus.</p>
            </div>
            <div class="answer">
                <p id="FrantaABCD" class="Franta"></p>
                <div class="centralizer" style="bottom:30px;">
                    <div class="ABCDodpovedi">
                        <button style="border:solid 3px rgb(189, 213, 234)" type="button" class="Felix" id="A" onclick="checkanswer('A')">Odpoved A</button>
                        <button style="border:solid 3px rgb(189, 213, 234)" type="button" class="Felix" id="B" onclick="checkanswer('B')">Odpoved B</button>
                        <button style="border:solid 3px rgb(189, 213, 234)" type="button" class="Felix" id="C" onclick="checkanswer('C')">Odpoved C</button>
                        <button style="border:solid 3px rgb(189, 213, 234)" type="button" class="Felix" id="D" onclick="checkanswer('D')">Odpoved D</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="task TextInput">
            <div class="questions">
                <b id="nzX" class="nzadani">Schreibst du die (richtige) Antwort.</b><br>
                <p id="czX" class="czadani">Napiš (správnou) odpověď.</p>
            </div>
            <div class="answer">
                <p id="FrantaX" class="Franta"></p>
                
                <div class="centralizer" style="bottom: 170px;">
                    <div id="XP">
                        <input type="text" id="TextInput" spellcheck="false">
                    </div>
                    <div id="SubstituteForInput">

                    </div>
                </div>
                <div class="centralizer" style="bottom: 70px;">
                    <button type="button" onclick="checkanswer('TextInput')" id="kontrola" style="margin-top:50px;">Kontroll</button>
                </div>
            </div>
        </div>
        <div class="task FLASHCARDS">
            <div class="questions">
                <b id="nzX" class="nzadani">Benutze die Pfeiltasten (←/→), um die Karten zu drehen.</b><br>
                <p id="czX" class="czadani">Pomocí šipek (←/→) otáčej karty. </p>
            </div>
            <p id="flashinfo"></p>

            <div id="table"class="centralizer">
                <div class="centralizer balicek repete"id="vyber" style="z-index:3;background-image: url(/static/images/repete.png)">
                    <div class="decks" id="VYBER"></div>
                </div>
                <div class="balicek" id="spatny" ><div class="decks" id="SPATNY"></div></div>
                <div class="balicek" id="dobry"><div class="decks" id="DOBRY"></div></div>
                
                <!--Jak vypadá karta
                    <div class="karta" draggable="true" >
                        <div class="textcentralizer">
                            <div class="front">
                                <p class="KartaText">das Deutsch</p>
                            </div>
                            <div class="back">
                                <p class="KartaText">němčina</p>
                            </div>
                        </div>
                    </div> 
                -->
            </div>
            <div id="bspopis"><b>wiederholen</b></div>
            <div id="bdpopis"><b>verstanden</b></div>
            <div id="vyhodnoceni"class=centralizer></div>
        </div>
        <div class="task CONNECTING">
            <div class="questions">
                <b id="nzX" class="nzadani">Verbinden Sie das deutsche Wort mit dem tschechischen Wort.</b><br>
                <p id="czX" class="czadani">Spoj německé slovíčko s českým.</p>
            </div>
            <div class="ConnectingTable">
                <div id="ConnectingControl" onclick="checkanswer()">Kontroll</div>
                <div id="RepeatConnecting" style="background-image: url(/static/images/repete.png)" onclick="teststart('Connecting')"> </div>
                <section id="CzechSection">
                    <div class="CzechWord" id="CZW1"></div>
                    <div class="CzechWord" id="CZW2"></div>
                    <div class="CzechWord" id="CZW3"></div>
                    <div class="CzechWord" id="CZW4"></div>
                    <div class="CzechWord" id="CZW5"></div>
                    <div class="CzechWord" id="CZW6"></div>
                    <div class="CzechWord" id="CZW7"></div>
                    <div class="CzechWord" id="CZW8"></div>
                    <div class="CzechWord" id="CZW9"></div>
                    <div class="CzechWord" id="CZW10"></div>
                </section>
                <div class="GridConnecting">
                    <div class="PlaceForWordCards" id="PTL1"></div><div class="GermanWord"id="GW1"></div>
                    <div class="PlaceForWordCards" id="PTL2"></div><div class="GermanWord"id="GW2"></div>
                    <div class="PlaceForWordCards" id="PTL3"></div><div class="GermanWord"id="GW3"></div>
                    <div class="PlaceForWordCards" id="PTL4"></div><div class="GermanWord"id="GW4"></div>
                    <div class="PlaceForWordCards" id="PTL5"></div><div class="GermanWord"id="GW5"></div>
                    <div class="PlaceForWordCards" id="PTL6"></div><div class="GermanWord"id="GW6"></div>
                    <div class="PlaceForWordCards" id="PTL7"></div><div class="GermanWord"id="GW7"></div>
                    <div class="PlaceForWordCards" id="PTL8"></div><div class="GermanWord"id="GW8"></div>
                    <div class="PlaceForWordCards" id="PTL9"></div><div class="GermanWord"id="GW9"></div>
                    <div class="PlaceForWordCards" id="PTL10"></div><div class="GermanWord"id="GW10"></div>

                </div>
            </div>
        </div>
        <div class="congratulation">
            <div style="display:flex;flex-direction:column;justify-content:center;align-items: center;position: absolute;width: 100%;height: 100%;">
                <p style="font-size: 42px;"><b>Gratulation zum Bestehen der Prüfung</b></p>
                <p style="font-size:30px;">Gratuluji k dokončení testu:</p><br>
                <p>Erfolgsquote / úspěšnost:</p><br>
                <p style="font-size: 100px;"id="procenta"></p>
            </div>
        </div>
        <div class="Teorie xPVerb">
            <table>
                <tr>
                    <th>id</th>
                    <th>slovíčko</th>
                </tr>
                <tr><td>1</td><td>haben</td></tr>
                <tr><td>[cislo]</td><td>[sloveso]</td></tr>
            </table>
        </div>
        <div class="Teorie xs">
            <b><div id="strana"></div></b>
            <div class="sgrid">
                <div id="slovicka">
                    <table id='slovnicek'>
                    </table>
                </div>
                <div class="Wgridchild Flashcards" onclick="teststart('FlashCards')">
                    Lernkarten
                </div>
                <div class="Wgridchild WritingCZ" onclick="teststart('NtoCZ')">
                    Psaní<br>
                    němčina<br>
                    ↓<br>
                    čeština
                </div>
                <div class="Wgridchild WritingN" onclick="teststart('CZtoN')">
                    Psaní<br>
                    čeština<br>
                    ↓<br>
                    němčina
                </div>
                <div class="Wgridchild Matches" onclick="teststart('Connecting')">
                    Verbinden
                </div>
            </div>
        </div>

        <div class="Teorie x3g1">
            <p class="nnadpis"><b>Verbkonjugation im Präsens</b></p>
            <p class="cnadpis">Časování sloves v přítomném čase</p>
            <div class="g">
                <table id="VK">
                    <tr><th></th><th colspan="2">pravidelná slovesa</th><th colspan="3">nepravidelná slovesa</th></tr>
                    <tr><th>infinitiv</th><td>spielen</td><td>trinken</td><td>haben</td><td>sein</td><td>essen</td></tr>
                    <tr><th>ich</th><td>spiel<span>e</span></td><td>trink<span>e</span></td><td>hab<span>e</span></td><td><span>bin</span></td><td>ess<span>e</span></td></tr>
                    <tr><th>du</th><td>spiel<span>st</span></td><td>trink<span>st</span></td><td><span>hast</span></td><td><span>bist</span></td><td><span>isst</span></td></tr>
                    <tr><th>er/sie/es</th><td>spiel<span>t</span></td><td>trink<span>t</span></td><td><span>hat</span></td><td><span>ist</span></td><td><span>isst</span></td></tr>
                    <tr><th>wir</th><td>spiel<span>en</span></td><td>trink<span>en</span></td><td>hab<span>en</span></td><td>sind</td><td>ess<span>en</span></td></tr>
                    <tr><th>ihr</th><td>spiel<span>t</span></td><td>trink<span>t</span></td><td>hab<span>t</span></td><td>seid</td><td>ess<span>t</span></td></tr>
                    <tr><th>sie/Sie</th><td>spiel<span>en</span></td><td>trink<span>en</span></td><td>hab<span>en</span></td><td><span>sind</span></td><td>ess<span>en</span></td></tr>
                </table>
            </div>
            <div></div>
            <div class="cara"> </div>
            <div class="b">
                <p class="ntext"><b>Übungen:</b></p>
                <p class="ctext">Cvičení:</p>
                <div class="t easyt" onclick="teststart('ABCD','3','grammar','1')">leichter Test</div>
                <div class="t hardt" onclick="teststart('TextInput','3','grammar','1')">schwieriger Test</div>
            </div>
            <div class="DidYouKnow">
                <div class="DidYKChild">
                    <div class="DYCKName"><b>1. Hast du das wissen?</b></div>
                    <div class="DYKCBody">
                        Věděl jsi, že v němčině při vykání vlastně "onikáme"?
                    </div>
                </div>
                <div class="DidYKChild">
                    <div class="DYCKName"><b>2. Hast du das wissen?</b></div>
                    <div class="DYKCBody">
                        Věděl jsi, že pro dobré znalosti němčiny je potřeba alespoň 4000 slovíček?
                    </div>
                </div>
            </div>
        </div>
        <div class="Teorie x3g2">asdasd</div>
        <div class="Teorie x3g3">asdasd</div>

        
        <div class="Teorie x3l1">nbmgzu</div>
        <div class="Teorie x3l2">hgkignmb</div>
        <div class="Teorie x3l3"></div>

        <div class="Teorie x3t1"></div>
        <div class="Teorie x3t2"></div>
        <div class="Teorie x3t3"></div>
    </div>
</div>
</div>
</div>
<script>
    function sleep(ms){
        return new Promise(resolve => setTimeout(resolve,ms))
    };
    //vše týkající se zviditelňování
     $(document).ready(function(){
        const a = [false,false,false,false,false]
        const x = document.querySelectorAll(".Module");
        const child = document.querySelectorAll(".child");
        const DidYouKnow = document.getElementsByClassName("DidYKChild");
        const L = document.querySelectorAll(".L");
        let DidYouKnowOPEN = [];
        // tohle zobrazuje Lektiony 1-15 v modulech

        for(let i=1;i<6;i++){
        $("#M"+i).click(function(){
            if (!(a[i-1]) ){
                for (let y=0;y<5;y++){
                    a[y]=false;
                    child[y].style.display="none";
                    x[y].style.height=x[y].getAttribute("value")+"rem";
                };
                a[i-1]=true;
                x[i-1].style.height=x[i-1].getAttribute("value2")+"rem";
                child[i-1].style.display="block";
            }
            else{
                a[i-1]=false;
                child[i-1].style.display="none";
                x[i-1].style.height=x[i-1].getAttribute("value")+"rem";
            };                 
        });
        };
        
        $("#TDContent").children().hide();
        //pracujou s rozklikáváním jednotlivých modelů
        for (let i=3;i<16;i++){
            $("#DIVL"+i).hide()
        }
        
        for(let i=3;i<L.length;i++){
            $("#L"+i).click(function(e){
                for(let i=0;i<L.length;i++){
                        L[i].style.color="black"
                }
                for (let i=3;i<16;i++){
                    $("#DIVL"+i).hide()
                }
                e.stopPropagation();

                if($("#DIVL"+i).is(":visible")){
                    
                    document.getElementById("L"+i).style.color="black";
                    $("#DIVL"+i).hide()
                }
                else{
                    document.getElementById("L"+i).style.color="gray";
                    $("#DIVL"+i).show()                
                }

            })
        }
        for(let i=0;i<DidYouKnow.length;i++){
            DidYouKnowOPEN.push[false];
        }
        for(let i=0;i<DidYouKnow.length;i++){
            console.log(DidYouKnow[i]);
            DidYouKnow[i].onclick= async function(){
                
                if (!DidYouKnowOPEN[i]){
                    for(let j=0;j<DidYouKnow.length;j++){
                        DidYouKnow[j].style.height="40px";
                        DidYouKnow[j].querySelector(".DYKCBody").style.visibility="hidden";
                        DidYouKnowOPEN[j]=false;
                    }
                    DidYouKnow[i].style.height="100px";
                    await sleep(200);
                    DidYouKnow[i].querySelector(".DYKCBody").style.visibility="visible";
                    DidYouKnowOPEN[i]=true;
                }
                else{
                    DidYouKnow[i].querySelector(".DYKCBody").style.visibility="hidden";
                    DidYouKnow[i].style.height="40px";
                    DidYouKnowOPEN[i]=false;
                }
                console.log(DidYouKnowOPEN);
            };
        };
    });
</script>
<script>
    // Vše týkající se testů 
    //kdybych se někdy divil proč jsem místo dict rozložil slovíčka na 2 array
    //je to z toho důvodu že přes internet dict přichází 
    //ROZHÁZENÉ a já nevím jak to :D
    const NJ = JSON.parse('{{ NJ1 | tojson | safe }}');
    const zakladnibarva = "3px solid rgb(189, 213, 234)";
    const spravnabarva = "rgb(25, 146, 61)";
    const spatnabarva = "rgb(199, 42, 42)";
    const oznacovacibarva = "3px solid rgb(87, 115, 153)";
    let UnusedQuestions;
    let MomentalQuestion;
    let TypeOfTest;
    let SetOfQuestions;
    let Success;
    let WordsInVocabulary=[];
    let OrderOfWords =[];
    let NumberForCalculationOfSuccess;
    let CanUseEnter=false;
    let CanUseEsc=false;
    let CanUseArrows=false;
    let CurrentVocabulary;
    let ABCDanswer=document.getElementsByClassName("Felix");
    const substituteForInput=document.getElementById("SubstituteForInput");
    const TextInput = document.getElementById("TextInput");
    const BorderForTextInput = document.getElementById("XP"); 
    let dvapokusy;
    let TenWords;
    let WhichBox;
    let z=0;
    let draggedItem = null;
    const config = { attributes: true, childList: true, characterData: true };

    //ABCD hover mod
    for (let i=0;i<4;i++){
        ABCDanswer[i].addEventListener("mouseover",function (event){
            if (event.target.style.border==zakladnibarva) {
                event.target.style.border=oznacovacibarva;                
            }
        })
        ABCDanswer[i].addEventListener("mouseleave",function (event){
            if (event.target.style.border==oznacovacibarva) {
                event.target.style.border=zakladnibarva;
            }
        })
    }    
//Obecné funkce pro otázky, ...
    //zobrazuje okno pro teorie, texty, otázky, ...
    function visibilator(lekce,typ,ukol){
        CanUseEsc=true;
        $("#clickDisabler").show();
        if (typ=="w"){
            CurrentVocabulary=NJ["lekce"+lekce]["words"][ukol];
            slovicka=""
            document.getElementById("slovnicek").innerHTML="<tr><th>id</th><th>německy</th><th>česky</th></tr>";
            for(let i=0;i<CurrentVocabulary[0];i++){
                slovicka+="<tr><td>"+(i+1)+"</td><td>"+CurrentVocabulary[2][i]+"</td><td>"+CurrentVocabulary[1][i]+"</td></tr>";
            };
            document.getElementById("slovnicek").innerHTML+=slovicka;
            document.getElementById("strana").innerHTML=ukol;
            $(".xs").show();
        }
        else{
            $(".x"+lekce+typ+ukol).show();
        }
    };
    // skovává okno pro teorie, texty, otázky, ...
    function hider(){
        $("#clickDisabler").hide();
        $("#TDContent").children().hide();
        $(".task").hide();
        $(".congratulation").hide();
        $("#ConnectingControl").hide();
        $("#RepeatConnecting").hide();
        balicekKaretDobry.innerHTML="";
        balicekKaretSpatny.innerHTML="";
        balicekKaretVyber.innerHTML="";
        for(let i=0;i<4;i++){
            ABCDanswer[i].style.border="solid 3px rgb(189, 213, 234)";
        }
        for(let i=1;i<11;i++){
            document.getElementById("PTL"+i).innerHTML="";
        }
        substituteForInput.innerHTML="";
        BorderForTextInput.style.border="none";
        TextInput.value="";
        CanUseEsc=false;
        CanUseEnter=false;
        CanUseArrows=false;
        dvapokusy=1;
    };
    // příprava sady otázek
    function teststart(type,k,t,x){
        $(".Teorie").hide();
        TypeOfTest=type;
        switch(type){
            case "ABCD":
            case "TextInput":
                $("."+type).show();
                SetOfQuestions=NJ["lekce"+k][t][x-1];
                UnusedQuestions=Array.from({length:SetOfQuestions.length}, (_, i) => i);
                Success=Array.from({length:SetOfQuestions.length},(_,i) => 1);
                NumberForCalculationOfSuccess=0
                newquestion();
                break;
            case "CZtoN":
            case "NtoCZ":
                $(".TextInput").show();
                UnusedQuestions=Array.from({length:CurrentVocabulary[0]}, (_, i) => i);
                Success=Array.from({length:CurrentVocabulary[0]},(_,i) => 1);
                NumberForCalculationOfSuccess=0
                newquestion();
                break;
            case "FlashCards":
                $(".FLASHCARDS").show();
                CanUseEnter=true;
                CanUseArrows=true;
                FlashcardsPreparing();
                break;
            case "Connecting":
                $(".CONNECTING").show();
                newquestion();
                break;
        }  
    };
    // zkontrolovává odpovědi, dál rozhoduje co se bude dít
    async function checkanswer(x){
        switch(TypeOfTest){
            case "ABCD":
                a=document.getElementById(x)
                if (SetOfQuestions[MomentalQuestion].a==a.innerHTML){
                    a.style.border="3px solid "+spravnabarva;
                    UnusedQuestions.splice(UnusedQuestions.indexOf(MomentalQuestion),1);
                    if(document.getElementById("chvilkanakontrolu").checked){
                        await sleep(500);
                    }
                    for (let i=0;i<4;i++){
                        ABCDanswer[i].style.border=zakladnibarva; 
                    }
                    newquestion()
                }
                else{
                    Success[MomentalQuestion]=0;
                    a.style.border="3px solid "+spatnabarva;
                }
                break;
            case "TextInput":
                if (SetOfQuestions[MomentalQuestion].a==TextInput.value){
                    UnusedQuestions.splice(UnusedQuestions.indexOf(MomentalQuestion),1);
                    BorderForTextInput.style.border="3px solid "+spravnabarva;

                    if(document.getElementById("chvilkanakontrolu").checked){
                        await sleep(500);
                    }
                    BorderForTextInput.style.border="none";
                    TextInput.value="";
                    newquestion()
                }
                else{
                    BorderForTextInput.style.border="3px solid "+spatnabarva;
                    if(dvapokusy==0){
                        Success[MomentalQuestion]=0;
                        substituteForInput.innerHTML=SetOfQuestions[MomentalQuestion].a;
                    }
                    else if (dvapokusy==-1) {
                        substituteForInput.innerHTML="";
                        UnusedQuestions.splice(UnusedQuestions.indexOf(MomentalQuestion),1);
                        BorderForTextInput.style.border="none";
                        TextInput.value="";
                        newquestion();
                    }
                    dvapokusy--;
                }
                break;
            case "NtoCZ":
            case "CZtoN":
                let n;
                let slovicka;
                let itcanbe=false;
                if(TypeOfTest=="NtoCZ"){
                    n=2;
                }else{
                    n=1
                }
                slovicka=CurrentVocabulary[n][MomentalQuestion].replace(" ", '').split(",");
                for(let i=0;i<slovicka.length;i++){
                    if (slovicka[i]==TextInput.value){
                        itcanbe=true;
                        break;
                    }
                }
                if(itcanbe){
                    UnusedQuestions.splice(UnusedQuestions.indexOf(MomentalQuestion),1);
                    BorderForTextInput.style.border="3px solid "+spravnabarva;

                    if(document.getElementById("chvilkanakontrolu").checked){
                        await sleep(500);
                    }
                    BorderForTextInput.style.border="none";
                    TextInput.value="";
                    newquestion();
                }
                else{
                    BorderForTextInput.style.border="3px solid "+spatnabarva;
                    if(dvapokusy==0){
                        Success[MomentalQuestion]=0;
                        substituteForInput.innerHTML=CurrentVocabulary[n][MomentalQuestion];
                    }else if(dvapokusy==-1){
                        substituteForInput.innerHTML="";
                        UnusedQuestions.splice(UnusedQuestions.indexOf(MomentalQuestion),1);
                        BorderForTextInput.style.border="none";
                        TextInput.value="";
                        newquestion();
                    }
                    dvapokusy--;
                }
                break;
            case "Connecting":
                for (let i=1;i<11;i++){
                    if(document.getElementById("CZW"+i).parentNode.id.replace("PTL","")==OrderOfWords[i-1]){
                        document.getElementById("CZW"+i).style.backgroundColor=spravnabarva;
                    }
                    else{
                        document.getElementById("CZW"+i).style.backgroundColor=spatnabarva;
                    }
                }
                $("#ConnectingControl").hide();
                $("#RepeatConnecting").show();
                break;
        }
    };
    // odesílá novou otázku
    function newquestion(){
        if(TypeOfTest=="Connecting"){
            for(let i=1;i<11;i++){
            document.getElementById("PTL"+i).innerHTML="";
            }
            $("#RepeatConnecting").hide();
            document.getElementById("CzechSection").innerHTML="";
            console.log("etwas");
            OrderOfWords=[];
            WordsInVocabulary=[];
            for(let i=1;i<11;i++){
                do{
                    a=Math.floor(Math.random()*CurrentVocabulary[0]);
                }
                while(WordsInVocabulary.includes(a));
                do{
                    b=Math.floor(Math.random()*10+1);
                }
                while(OrderOfWords.includes(b));
                let blok = document.createElement("div");
                blok.setAttribute("class","CzechWord");
                blok.setAttribute("id","CZW"+i);
                blok.appendChild(document.createTextNode(CurrentVocabulary[1][a]));
                document.getElementById("CzechSection").appendChild(blok);
                document.getElementById("GW"+b).innerHTML=CurrentVocabulary[2][a];
                WordsInVocabulary.push(a);
                OrderOfWords.push(b);
            }
            enableDrag(document.getElementsByClassName("CzechWord"),document.getElementsByClassName("PlaceForWordCards"));
            enableDrag(document.getElementsByClassName("CzechWord"),[document.getElementById("CzechSection")]);
        }
        else if (UnusedQuestions.length>0){
            do{
                switch(TypeOfTest){
                    case "ABCD":
                    case "TextInput":
                        a=Math.floor(Math.random()*SetOfQuestions.length);   
                        break;
                    case "CZtoN":
                    case "NtoCZ":
                        a=Math.floor(Math.random()*CurrentVocabulary[0]);
                        break;   
                }
            }
            while(!UnusedQuestions.includes(a));
            MomentalQuestion=a;
            dvapokusy=1;
            switch(TypeOfTest){
                case "ABCD":
                    document.getElementById("nzABCD").innerHTML=SetOfQuestions[MomentalQuestion].zadaniN;
                    document.getElementById("czABCD").innerHTML=SetOfQuestions[MomentalQuestion].zadaniC;
                    document.getElementById("FrantaABCD").innerHTML=SetOfQuestions[a]["q"];
                    b=["a","1","2","3"];
                    for (let i=0;i<4;i++){
                        d=Math.floor(Math.random()*(3-i));
                        ABCDanswer[i].innerHTML=SetOfQuestions[a][b[d]];
                        b.splice(d,1);
                    };
                    break;
                case "TextInput":
                    TextInput.focus();
                    CanUseEnter=true;
                    document.getElementById("nzX").innerHTML=SetOfQuestions[MomentalQuestion].zadaniN;
                    document.getElementById("czX").innerHTML=SetOfQuestions[MomentalQuestion].zadaniC;
                    document.getElementById("FrantaX").innerHTML=SetOfQuestions[a]["q"];
                    break;
                case "CZtoN":
                    TextInput.focus();
                    CanUseEnter=true;
                    document.getElementById("nzX").innerHTML="Schreibst du die deutsche Version des Wortes.";
                    document.getElementById("czX").innerHTML="Napiš německou verzi slovíčka.";
                    document.getElementById("FrantaX").innerHTML=CurrentVocabulary[2][MomentalQuestion];
                    break;
                case "NtoCZ":
                    TextInput.focus();
                    CanUseEnter=true;
                    document.getElementById("nzX").innerHTML="Schreibst du die tschechische Version des Wortes.";
                    document.getElementById("czX").innerHTML="Napiš českou verzi slovíčka.";
                    document.getElementById("FrantaX").innerHTML=CurrentVocabulary[1][MomentalQuestion];
                    break;
            };
        }
        else{
            endoftest();
        };
    };
    // ukončení testu, gratulace
    function endoftest(){
        $(".task").hide();
        for (let i=0;i<Success.length;i++){
            NumberForCalculationOfSuccess+=Success[i];
        };
        document.getElementById("procenta").innerHTML=Math.round(NumberForCalculationOfSuccess/Success.length*100)+"%";
        $(".congratulation").show();
        CanUseArrows=false;
        CanUseEnter=false;
    }
    // hlídá, jestli má zobrazit výsledek pro TextInput nebo ne 
    let SubstituteForInputKontrol = new MutationObserver(function(){
        if (substituteForInput.innerHTML!=""){
            BorderForTextInput.style.display="none";
            substituteForInput.style.display="block";
        }
        else{
            substituteForInput.style.display="none";
            BorderForTextInput.style.display="block";
        };
    });
    SubstituteForInputKontrol.observe(substituteForInput,config);
    

    // na zmáčknutí určitých kláves
    document.addEventListener("keydown",function(e){
        if(e.key==="Enter" && CanUseEnter){
            switch (TypeOfTest){
            case "FlashCards":
                rotatecard(balicekKaretVyber.children[balicekKaretVyber.children.length-1]);
                break;
            case "CZtoN":
            case "NtoCZ":
            case "TextInput":
                if (dvapokusy==-1){
                    substituteForInput.innerHTML="";
                    UnusedQuestions.splice(UnusedQuestions.indexOf(MomentalQuestion),1);
                    BorderForTextInput.style.border="none";
                    TextInput.value="";
                    newquestion();
                }else if (dvapokusy==1 || dvapokusy==0){
                    checkanswer("TextInput");
                }
            }
        }
        else if (e.key==="Escape" && CanUseEsc){
            hider();
        }
        else if (e.key==="ArrowLeft" && CanUseArrows){
            if(balicekKaretVyber.firstChild){
                balicekKaretSpatny.appendChild(balicekKaretVyber.children[balicekKaretVyber.children.length-1]);
            }
        }
        else if (e.key==="ArrowRight" && CanUseArrows){
            if(balicekKaretVyber.firstChild){
                balicekKaretDobry.appendChild(balicekKaretVyber.children[balicekKaretVyber.children.length-1]);
            }
        };
    })
//---------------------------------------------------------------------------
// Flashcards ---------------------------------------------------------------
    const balicekKaretVyber = document.getElementById("VYBER");
    const balicekKaretSpatny = document.getElementById("SPATNY");
    const balicekKaretDobry = document.getElementById("DOBRY");
    const vyhodnoceni = document.getElementById("vyhodnoceni");
    const flashinfo = document.getElementById("flashinfo")
    // zde se připravuje balíček karet
    function FlashcardsPreparing(){
        resetDecks();
        removeDrag(document.querySelectorAll('.karta'),document.querySelectorAll('.decks'));
        balicekKaretSpatny.innerHTML="";
        balicekKaretDobry.innerHTML="";
        balicekKaretVyber.innerHTML="";
        balicekKaretVyber.onclick=null;
        // dragRemove(balicekKaretSpatny);
        // dragRemove(document.getElementById("vyber"));
        flashinfo.innerHTML="";
        for(let i=0;i<CurrentVocabulary[0];i++){
            let karta = document.createElement("div");
            let centralizer = document.createElement("div");
            let textf = document.createElement("p");
            let textb = document.createElement("p");
            let front = document.createElement("div");
            let back = document.createElement("div");
            karta.setAttribute("class","karta");
            centralizer.setAttribute("class","textcentralizer");
            karta.appendChild(centralizer);
            
            karta.setAttribute("onclick","rotatecard()");
            karta.setAttribute("draggable","true");

            textf.setAttribute("class","KartaText");
            textf.appendChild(document.createTextNode(CurrentVocabulary[2][i]));
            textb.setAttribute("class","KartaText");
            textb.appendChild(document.createTextNode(CurrentVocabulary[1][i]));
            
            front.setAttribute("class","card-side front");
            back.setAttribute("class","card-side back");
            front.appendChild(textf);
            back.appendChild(textb);
            
            centralizer.appendChild(front);
            centralizer.appendChild(back);
            karta.setAttribute("onclick","rotatecard(this)");
            karta.setAttribute("id",i);
            balicekKaretVyber.appendChild(karta);
        };

        enableDrag(document.querySelectorAll('.karta'),document.querySelectorAll('.decks'));

        
        let kontrola = new MutationObserver(function(mutations){
            if (balicekKaretVyber.children.length==0){
                vyhodnoceni.innerHTML=Math.round(balicekKaretDobry.children.length/CurrentVocabulary[0]*100)+"%";
                balicekKaretSpatny.onmouseover=function(){
                    flashinfo.innerHTML="Willst du deine Fehler korrigieren?";
                    document.getElementById("spatny").style.border="rgb(130,0,0) solid 10px";
                    document.getElementById("spatny").style.cursor="pointer";
                };
                balicekKaretSpatny.onmouseout=function(){
                    flashinfo.innerHTML="";
                    document.getElementById("spatny").style.border="rgb(160,22,22) solid 10px";
                    document.getElementById("spatny").style.cursor="auto";
                };
                document.getElementById("vyber").onmouseover=function(){
                    flashinfo.innerHTML="Möchtest du das Kartendeck wiederholen?";
                    document.getElementById("vyber").style.border="rgb(100, 100, 100) solid 10px";
                    document.getElementById("vyber").style.cursor="pointer";

                }
                document.getElementById("vyber").onmouseout=function(){
                    flashinfo.innerHTML="";
                    document.getElementById("vyber").style.border="rgb(126, 126, 126) solid 10px";
                    document.getElementById("vyber").style.cursor="auto";
                }
                document.getElementById("vyber").setAttribute("onclick","FlashcardsPreparing()");
                removeDrag(document.querySelectorAll('.karta'),document.querySelectorAll('.decks'));
                enableDrag([balicekKaretSpatny],[balicekKaretVyber]);
                enableDrag(balicekKaretVyber.children,document.querySelectorAll('.decks'))
            };
        })
        kontrola.observe(balicekKaretVyber,config);
    
        
    };
    // otáčí kartu o 180°
    function rotatecard(t){
        let front = t.children[0].children[0];
        let back = t.children[0].children[1];
        if (front.style.transform=="rotateY(0deg)"){
            front.style.transform="rotateY(180deg)"
            back.style.transform="rotateY(0deg)"
        }else{
            front.style.transform="rotateY(0deg)"
            back.style.transform="rotateY(180deg)"
        }
    }
    // obnovuje výchozí nastavení balíčků
    function resetDecks(){
        balicekKaretSpatny.onmouseover="";
        balicekKaretSpatny.onmouseout="";
        document.getElementById("vyber").onmouseover="";
        document.getElementById("vyber").onmouseout="";
        document.getElementById("vyber").style.border="rgb(126, 126, 126) solid 10px";
    }
    //hlídá jestli se má flashinfo zobrazit nebo ne
    let flashinfokontrola = new MutationObserver(function(){
        if (flashinfo.innerHTML==""){
            flashinfo.style.visibility="hidden";
        }
        else {
            flashinfo.style.visibility="visible";
        };
    }) ;
    flashinfokontrola.observe(flashinfo,config);
    //hlídá počet karet v balíčku "výběr"
    let CardsLeft = new MutationObserver(function(){
        vyhodnoceni.innerHTML=balicekKaretVyber.children.length;
    });
    CardsLeft.observe(balicekKaretVyber,config);
//------------------------------------------------------------
// Connecting stuff
    let CzechSectionKontrol = new MutationObserver(function(){
        if(document.getElementById("CzechSection").querySelectorAll(".CzechWord").length==0){
            $("#ConnectingControl").show();
        }
        else{
            $("#ConnectingControl").hide();
        }
    })
    CzechSectionKontrol.observe(document.getElementById("CzechSection"),config);

//------------------------------------------------------------
// Draggable stuff
    function drags(){
        let item= this
        draggedItem =item;
        setTimeout(function () {
            item.style.display = 'none';
        }, 0)
    }
    function drage(){
        setTimeout(function () {
            draggedItem.style.display = 'block';
            draggedItem = null;
        }, 0);
    }
    function pD(e){
        e.preventDefault();
    }
    function drop(){
        if (TypeOfTest=="Connecting"){
            if (this.querySelector("#"+draggedItem.id)){
            }
            else if(this.firstChild){
                draggedItem.style.margin="5px";
                document.getElementById("CzechSection").append(draggedItem);
            }
            else {
                draggedItem.style.margin="0px";
                this.append(draggedItem);
            }
        }
        else{
            if (draggedItem==balicekKaretSpatny){
                let x = balicekKaretSpatny.children.length;
                for(let i=0;i<x;i++){
                    this.append(balicekKaretSpatny.children[0]);
                }
                balicekKaretSpatny.style.display="block";
                resetDecks();
                removeDrag([balicekKaretSpatny],[balicekKaretVyber]);
            }else{
                this.append(draggedItem);
            }
        }
    }
    function enableDrag(ToDraw,PlaceToPut){
        let list_items = ToDraw;
        let lists = PlaceToPut;
        for (let i = 0; i < list_items.length; i++) {
            let item = list_items[i];
            item.setAttribute("draggable","true");
            item.addEventListener('dragstart',drags);
            item.addEventListener('dragend',drage);
            for (let j = 0; j < lists.length; j ++) {
                let list = lists[j];
                list.addEventListener('dragover',pD);
                list.addEventListener('dragenter',pD);
                list.addEventListener('drop',drop);
                
            }
        }
    }
    function removeDrag(ToDraw,PlaceToPut){
        let cards = ToDraw;
        let deck = PlaceToPut;
        for (let i = 0; i < cards.length; i++) {
            let item = cards[i];
            item.setAttribute("draggable","false");
            item.removeEventListener('dragstart',drags);
            item.removeEventListener('dragend',drage);
            for (let j = 0; j < deck.length; j ++) {
                let list = deck[j];
                list.removeEventListener('dragover',pD);
                list.removeEventListener('dragenter',pD);
                list.removeEventListener('drop',drop);
            }
        }
    }
</script>
{%endblock%}