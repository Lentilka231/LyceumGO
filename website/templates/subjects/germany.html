{%extends "baselog.html"%}
{%block title%}Nƒõmƒçina{% endblock %}
{%block head%}
<link rel= "stylesheet" type= "text/css" href="{{url_for('static', filename='/stylesheets/subject.css')}}">
<link rel= "stylesheet" type= "text/css" href="{{url_for('static', filename='/stylesheets/subjects/germany.css')}}">
{%endblock%}
{%block content%}

<div id="MainDiv">
<div id="grid-container">
<div class="NAME"><b>Nƒõmƒçina</b></div>
<div class="grid-items first">
    <div class="scrollery">
        <div id="subclassinfo">
            <p>T≈ô√≠da: {{subclass.classroomname}}</p>
            <p>Progres: {{subclass.progres}}</p>
            <div id="PVerb" onclick="visibilator('PVerb','','')"  style="cursor:pointer;">
                Verb/Slovesa
            </div>
        </div>
    </div>
    <div class="bsetings">
        <input type="checkbox" id="chvilkanakontrolu"> <label for="chvilkanakontrolu">dodateƒçn√Ω ƒças po odpovƒõdi</label>
    </div>
</div>
<div class="grid-items second">
    <div class="scrollery">
        <div class="Module" id="M1" tabindex="1" style="background-color: rgb(115, 64, 155);">
            <p><b>1) Deutsch ist NICHT leicht!</b></p>
            <div class="child">
                <p class="L" id="L3" >Lektion 1-3</p>
            </div>                
        </div>
        <div class="Module" id="M2" tabindex="1" style="background-color: orange;">
            <p><b>2) Hobbys und Schule</b></p>
            <div class="child">
                <p class="L" id="L4">Lektion 4</p>
                <p class="L" id="L5">Lektion 5</p>
                <p class="L" id="L6">Lektion 6</p>
            </div> 
        </div>
        <div class="Module" id="M3" tabindex="1" style="background-color: rgb(153, 28, 126);">
            <p><b>3) Freizeit und Feiern</b></p>
            <div class="child">
                <p class="L" id="L7">Lektion 7</p>
                <p class="L" id="L8">Lektion 8</p>
                <p class="L" id="L9">Lektion 9</p>
            </div>
        </div>
        <div class="Module" id="M4" tabindex="1" style="background-color: rgb(30, 150, 70);">
            <p><b>4) Essen, Einkaufen und Gesundheit</b></p>
            <div class="child">
                <p class="L" id="L10">Lektion 10</p>
                <p class="L" id="L11">Lektion 11</p>
                <p class="L" id="L12">Lektion 12</p>
            </div>
        </div>
        <div class="Module" id="M5" tabindex="1" style="background-color: rgb(74, 101, 160);">
                <p><b>5) Module 5</b></p>
            <div class="child">
                <p class="L" id="L13">Lektion 13</p>
                <p class="L" id="L14">Lektion 14</p>
                <p class="L" id="L15">Lektion 15</p>
            </div>
        </div>
    </div>
</div>
<div class="grid-items third">
    <div class="scrollery">
        <div id="DIVL3">
            <div class="DIVchild" id="gramatik" style="background-color: rgb(185, 120, 185);">
                <b class="nadpisChild">Gramatik</b>
                <div class="Material">
                    <div class="Block b11"onclick="visibilator('3','g',1)">
                        <b>Verbkonjugation im Pr√§sens</b><br>
                        ƒåasov√°n√≠ sloves v p≈ô√≠tomn√©m ƒçase
                    </div>
                    <div class="Block b11"onclick="visibilator('3','g',2)">
                        <b>Unbestimmte und bestimmte Artikel</b><br>
                        Neurƒçit√© a urƒçitƒõ ƒçleny
                    </div>
                    <div class="Block b11"onclick="visibilator('3','g',3)">
                        <b>Possessivartikel</b><br>
                        P≈ôivlas≈•novac√≠ z√°jmena
                    </div>
                </div>
            </div>
            <div class="DIVchild" id="wortschatz" style="background-color: rgb(157, 101, 201);">
                <b class="nadpisChild">Wortschatz</b>
                <div class="Material">
                    {%for i,v in NJ1["lekce3"]["words"].items()%}
                    <div class="Block b12" onclick="visibilator('3','w','{{i}}')">
                        <b>{{i}}</b>
                        <div class="celkemwort">
                            {{v[0]}}
                        </div>
                    </div>
                    {%endfor%}
                    
                </div>
            </div>
            <div class="DIVchild" id="lesen" style="background-color: rgb(93, 84, 164);">
                <b class="nadpisChild">Lesen</b>
                <div class="Material">
                    <div class="Block b13" onclick="visibilator('l','1')">
                        <b>Text1</b><br>
                        Hallo Leute!
                    </div>
                    <div class="Block b13" onclick="visibilator('l','2')">
                        <b>Text2</b><br>
                        Heute habe ich nicht Geburstag.
                    </div>
                    <div class="Block b13" onclick="visibilator('l','3')">
                        <b>Text3</b><br>
                        Prag ist teuer.
                    </div>
                    <div class="Block b13" onclick="visibilator('l','4')">
                        <b>Text4</b><br>
                        Meine Familie ist gro√ü.
                    </div>
                </div>
            </div>
            <div class="DIVchild" id="endtest" style="background-color: rgb(54, 80, 136);">
                <b class="nadpisChild">Tests</b>
            </div>
        </div>
    </div>
</div>
</div>

<!------------------------------------------------------------------------------------------------------------>
<div id="TestDiv">
    <div class="krizek" onclick="hider()" tabindex=3 style="z-index: 2;">‚úï</div>
    <div id="TDContent">
        <div class="task ABCD">
            <div class="questions">
                <b id="nzABCD" class="nzadani">W√§hlst du die (richtige) Antwort, wenigstens versuchst du es.</b><br>
                <p id="czABCD" class="czadani">Vyber (spr√°vnou) odpovƒõƒè, alespo≈à to zkus.</p>
            </div>
            <div class="answer">
                <p id="FrantaABCD" class="Franta"></p>
                <div class="centralizer" style="bottom:30px;">
                    <div class="ABCDodpovedi">
                        <button style="border:solid 3px rgb(189, 213, 234)" type="button" class="Felix" id="A" onclick="checkanswer('A')">Odpoved A</button>
                        <button style="border:solid 3px rgb(189, 213, 234)" type="button" class="Felix" id="B" onclick="checkanswer('B')">Odpoved B</button>
                        <button style="border:solid 3px rgb(189, 213, 234)" type="button" class="Felix" id="C" onclick="checkanswer('C')">Odpoved C</button>
                        <button style="border:solid 3px rgb(189, 213, 234)" type="button" class="Felix" id="D" onclick="checkanswer('D')">Odpoved D</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="task X">
            <div class="questions">
                <b id="nzX" class="nzadani">Schreibst du die (richtige) Antwort.</b><br>
                <p id="czX" class="czadani">Napi≈° (spr√°vnou) odpovƒõƒè.</p>
            </div>
            <div class="answer">
                <p id="FrantaX" class="Franta"></p>
                
                <div class="centralizer" style="bottom: 170px;">
                    <div id="XP">
                        <input type="text" id="X" spellcheck="false">
                    </div>
                    <div id="SubstituteForInput">

                    </div>
                </div>
                <div class="centralizer" style="bottom: 70px;">
                    <button type="button" onclick="checkanswer('X')" id="kontrola" style="margin-top:50px;">Kontroll</button>
                </div>
            </div>
        </div>
        <div class="task FLASHCARDS">
            <div class="questions">
                <b id="nzX" class="nzadani">Schreibst du die (richtige) Antwort.</b><br>
                <p id="czX" class="czadani">Pomoc√≠ ≈°ipek (‚Üê/‚Üí) ot√°ƒçej karty. </p>
            </div>
            <div class="centralizer stul">
                <div id="balicek1">
                    <div class="karta draggable" >
                        <div class="centralizer" style="width:90%">
                            <p class="KartaText">nejaky text</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="congratulation">
            <div style="display:flex;flex-direction:column;justify-content:center;align-items: center;position: absolute;width: 100%;height: 100%;">
                <p style="font-size: 42px;"><b>Gratulation zum Bestehen der Pr√ºfung</b></p>
                <p style="font-size:30px;">Gratuluji k dokonƒçen√≠ testu:</p><br>
                <p>Erfolgsquote / √∫spƒõ≈°nost:</p><br>
                <p style="font-size: 100px;"id="procenta"></p>
            </div>
        </div>
        <div class="Mufasa xPVerb">
            <table>
                <tr>
                    <th>id</th>
                    <th>slov√≠ƒçko</th>
                </tr>
                <tr><td>1</td><td>haben</td></tr>
                <tr><td>[cislo]</td><td>[sloveso]</td></tr>
            </table>
        </div>
        <div class="Mufasa xs">
            <b><div id="strana"></div></b>
            <div class="sgrid">
                <div id="slovicka">
                    <table id='slovnicek'>
                    </table>
                </div>
                <div class="Wgridchild Flashcards" onclick="tp('FlashCards')">
                    Flashcards
                </div>
                <div class="Wgridchild WritingCZ" onclick="tp('NtoCZ')">
                    Psan√≠<br>
                    nƒõmƒçina<br>
                    ‚Üì<br>
                    ƒçe≈°tina
                </div>
                <div class="Wgridchild WritingN" onclick="tp('CZtoN')">
                    Psan√≠<br>
                    ƒçe≈°tina<br>
                    ‚Üì<br>
                    nƒõmƒçina
                </div>
                <div class="Wgridchild Matches">
                    Spojov√°n√≠
                </div>
            </div>
        </div>

        <div class="Mufasa x3g1">
            <p class="nnadpis"><b>Verbkonjugation im Pr√§sens</b></p>
            <p class="cnadpis">ƒåasov√°n√≠ sloves v p≈ô√≠tomn√©m ƒçase</p>
            <div class="g">
                <table id="VK">
                    <tr><th></th><th colspan="2">pravideln√° slovesa</th><th colspan="3">nepravideln√° slovesa</th></tr>
                    <tr><th>infinitiv</th><td>spielen</td><td>trinken</td><td>haben</td><td>sein</td><td>essen</td></tr>
                    <tr><th>ich</th><td>spiel<span>e</span></td><td>trink<span>e</span></td><td>hab<span>e</span></td><td><span>bin</span></td><td>ess<span>e</span></td></tr>
                    <tr><th>du</th><td>spiel<span>st</span></td><td>trink<span>st</span></td><td><span>hast</span></td><td><span>bist</span></td><td><span>isst</span></td></tr>
                    <tr><th>er/sie/es</th><td>spiel<span>t</span></td><td>trink<span>t</span></td><td><span>hat</span></td><td><span>ist</span></td><td><span>isst</span></td></tr>
                    <tr><th>wir</th><td>spiel<span>en</span></td><td>trink<span>en</span></td><td>hab<span>en</span></td><td>sind</td><td>ess<span>en</span></td></tr>
                    <tr><th>ihr</th><td>spiel<span>t</span></td><td>trink<span>t</span></td><td>hab<span>t</span></td><td>seid</td><td>ess<span>t</span></td></tr>
                    <tr><th>sie/Sie</th><td>spiel<span>en</span></td><td>trink<span>en</span></td><td>hab<span>en</span></td><td><span>sind</span></td><td>ess<span>en</span></td></tr>
                </table>
            </div>
            <p class="didyouknow">Vƒõdƒõliste, ≈æe v nƒõmƒçinƒõ p≈ôi vyk√°n√≠ vlastnƒõ "onik√°me".</p>
            <div class="cara"> </div>
            <div class="b">
                <p class="ntext"><b>√úbungen:</b></p>
                <p class="ctext">Cviƒçen√≠:</p>
                <div class="t easyt" onclick="tp('ABCD','3','grammar','1')">leichter Test</div>
                <div class="t hardt" onclick="tp('X','3','grammar','1')">schwieriger Test</div>
            </div>
        </div>
        <div class="Mufasa x3g2">asdasd</div>
        <div class="Mufasa x3g3">asdasd</div>

        

        <div class="Mufasa x3l1">nbmgzu</div>
        <div class="Mufasa x3l2">hgkignmb</div>
        <div class="Mufasa x3l3"></div>

        <div class="Mufasa x3t1"></div>
        <div class="Mufasa x3t2"></div>
        <div class="Mufasa x3t3"></div>
    </div>
</div>
</div>
<script>

    //v≈°e t√Ωkaj√≠c√≠ se zviditel≈àov√°n√≠
     $(document).ready(function(){
        const a = [false,false,false,false,false]
        const x = document.querySelectorAll(".Module");
        const child = document.querySelectorAll(".child");
        const L = document.querySelectorAll(".L")
        // tohle zobrazuje Lektiony 1-15 v modulech
        for(let i=1;i<6;i++){
            $("#M"+i).click(function(){
                if (!(a[i-1]) ){
                    for (let y=0;y<5;y++){
                        a[y]=false;
                        child[y].style.display="none";
                    };
                    a[i-1]=true;
                    child[i-1].style.display="block";
                }
                else{
                    a[i-1]=false;
                    child[i-1].style.display="none";
                };                 
            });
        };
        $("#TDContent").children().hide()
        //pracujou s rozklik√°v√°n√≠m jednotliv√Ωch model≈Ø
        for (let i=3;i<16;i++){
            $("#DIVL"+i).hide()
        }
        
        for(let i=3;i<L.length;i++){
            $("#L"+i).click(function(e){
                for(let i=0;i<L.length;i++){
                        L[i].style.color="black"
                }
                for (let i=3;i<16;i++){
                    $("#DIVL"+i).hide()
                }
                e.stopPropagation();
                if($("#DIVL"+i).is(":visible")){
                    
                    document.getElementById("L"+i).style.color="black";
                    $("#DIVL"+i).hide()
                }
                else{
                    document.getElementById("L"+i).style.color="gray";
                    $("#DIVL"+i).show()                
                }

            })
        }

    });
</script>
<script>
    // V≈°e t√Ωkaj√≠c√≠ se test≈Ø 
    //kdybych se nƒõkdy divil proƒç jsem m√≠sto dict rozlo≈æil slov√≠ƒçka na 2 array
    //je to z toho d≈Øvodu ≈æe p≈ôes internet dict p≈ôich√°z√≠ 
    //ROZH√ÅZEN√â a j√° nev√≠m jak to :D
    const NJ = JSON.parse('{{ NJ1 | tojson | safe }}');
    const zakladnibarva = "3px solid rgb(189, 213, 234)";
    const spravnabarva = "3px solid rgb(25, 146, 61)";
    const spatnabarva = "3px solid rgb(199, 42, 42)";
    const oznacovacibarva = "3px solid rgb(87, 115, 153)";
    let UnusedQuestions;
    let MomentalQuestion;
    let TypeOfTest;
    let SetOfQuestions;
    let Success =[];
    let NumberForCalculationOfSuccess;
    let CanUseEnter=false;
    let CanUseEsc=false;
    let CanUseArrows=false;
    let CurrentVocabulary;
    let ABCDanswer=document.getElementsByClassName("Felix");
    let dvapokusy;
    for (let i=0;i<4;i++){
        ABCDanswer[i].addEventListener("mouseover",function (event){
            if (event.target.style.border==zakladnibarva) {
                event.target.style.border=oznacovacibarva;                
            }
        })
        ABCDanswer[i].addEventListener("mouseleave",function (event){
            if (event.target.style.border==oznacovacibarva) {
                event.target.style.border=zakladnibarva;
            }
        })
    }    
    function FlashcardsPreparing(){

    }
    function visibilator(lekce,typ,ukol){
        CanUseEsc=true;
        $("#TestDiv").show();
        if (typ=="w"){
            CurrentVocabulary=NJ["lekce"+lekce]["words"][ukol];
            slovicka=""
            document.getElementById("slovnicek").innerHTML="<tr><th>id</th><th>nƒõmecky</th><th>ƒçesky</th></tr>";
            for(let i=0;i<CurrentVocabulary[0];i++){
                slovicka+="<tr><td>"+(i+1)+"</td><td>"+CurrentVocabulary[1][i]+"</td><td>"+CurrentVocabulary[2][i]+"</td></tr>";
            };
            document.getElementById("slovnicek").innerHTML+=slovicka;
            document.getElementById("strana").innerHTML=ukol;
            $(".xs").show();
        }
        else{
            $(".x"+lekce+typ+ukol).show();
        }
    };
    function hider(){
        $("#TestDiv").hide();
        $("#TDContent").children().hide();
        $(".task").hide();
        $(".congratulation").hide();
        for(let i=0;i<4;i++){
            ABCDanswer[i].style.border="solid 3px rgb(189, 213, 234)";
        }
        document.getElementById("XP").style.border="none";
        document.getElementById("X").value="";
        CanUseEsc=false;
        dvapokusy=1;
    };
    function endOfTest(){
        $(".task").hide();
        for(let i=0;i<Success.length;i++){
            NumberForCalculationOfSuccess+=Success[i];
        };
        document.getElementById("procenta").innerHTML=Math.round(NumberForCalculationOfSuccess/Success.length*100)+"%";
        $(".congratulation").show();
        CanUseEnter=false;

    };
    function sleep(ms){
        return new Promise(resolve => setTimeout(resolve,ms))
    };
    document.addEventListener("keydown",function(e){
        if(e.key==="Enter" & CanUseEnter){
            if (dvapokusy==-1){
                document.getElementById("SubstituteForInput").innerHTML="";
                $("#SubstituteForInput").hide();
                $("#XP").show();
                UnusedQuestions.splice(UnusedQuestions.indexOf(MomentalQuestion),1);
                document.getElementById("XP").style.border="none";
                document.getElementById("X").value="";
                newquestion();
            }
            else{
                checkanswer("X");
            }
        }
        else if (e.key==="Escape" & CanUseEsc){
            hider();
        }
    })
    async function checkanswer (x){
        switch(TypeOfTest){
            case "ABCD":
                a=document.getElementById(x)
                if (SetOfQuestions[MomentalQuestion].a==a.innerHTML){
                    a.style.border=spravnabarva;
                    UnusedQuestions.splice(UnusedQuestions.indexOf(MomentalQuestion),1);
                    if(document.getElementById("chvilkanakontrolu").checked){
                        await sleep(500);
                    }
                    for (let i=0;i<4;i++){
                        ABCDanswer[i].style.border=zakladnibarva; 
                    }
                    newquestion()
                }
                else{
                    Success[MomentalQuestion]=0;
                    a.style.border=spatnabarva;
                }
                break;
            case "X":
                if (SetOfQuestions[MomentalQuestion].a==document.getElementById("X").value){
                    UnusedQuestions.splice(UnusedQuestions.indexOf(MomentalQuestion),1);
                    document.getElementById("XP").style.border=spravnabarva;

                    if(document.getElementById("chvilkanakontrolu").checked){
                        await sleep(500);
                    }
                    document.getElementById("XP").style.border="none";
                    document.getElementById("X").value="";
                    newquestion()
                }
                else{
                    document.getElementById("XP").style.border=spatnabarva;
                    if(dvapokusy==0){
                        Success[MomentalQuestion]=0;
                        document.getElementById("SubstituteForInput").innerHTML=SetOfQuestions[MomentalQuestion].a;
                        $("#SubstituteForInput").show();
                        $("#XP").hide();
                    }
                    else if (dvapokusy==-1) {
                        document.getElementById("SubstituteForInput").innerHTML="";
                        $("#SubstituteForInput").hide();
                        $("#XP").show();
                        UnusedQuestions.splice(UnusedQuestions.indexOf(MomentalQuestion),1);
                        document.getElementById("XP").style.border="none";
                        document.getElementById("X").value="";
                        newquestion();
                    }
                    dvapokusy--;
                }
                break;
            case "NtoCZ":
            case "CZtoN":
                let n;
                let slovicka;
                let itcanbe=false;
                if(TypeOfTest=="NtoCZ"){
                    n=1;
                }else{
                    n=2
                }
                slovicka=CurrentVocabulary[n][MomentalQuestion].replace("/\s/g", '').split(",")
                for(let i=0;i<slovicka.length;i++){
                    if (slovicka[i]==document.getElementById("X").value){
                        itcanbe=true;
                        break;
                    }
                }
                if(itcanbe){
                    UnusedQuestions.splice(UnusedQuestions.indexOf(MomentalQuestion),1);
                    document.getElementById("XP").style.border=spravnabarva;

                    if(document.getElementById("chvilkanakontrolu").checked){
                        await sleep(500);
                    }
                    document.getElementById("XP").style.border="none";
                    document.getElementById("X").value="";
                    newquestion();
                }
                else{
                    document.getElementById("XP").style.border=spatnabarva;
                    if(dvapokusy==0){
                        Success[MomentalQuestion]=0;
                        document.getElementById("SubstituteForInput").innerHTML=CurrentVocabulary[n][MomentalQuestion];
                        $("#SubstituteForInput").show();
                        $("#XP").hide();
                    }else if(dvapokusy==-1){
                        document.getElementById("SubstituteForInput").innerHTML="";
                        $("#SubstituteForInput").hide();
                        $("#XP").show();
                        UnusedQuestions.splice(UnusedQuestions.indexOf(MomentalQuestion),1);
                        document.getElementById("XP").style.border="none";
                        document.getElementById("X").value="";
                        newquestion();
                    }
                    dvapokusy--;
                }
                break;
        }
    };
    function newquestion (){

        if (UnusedQuestions.length>0){
            do{
                switch(TypeOfTest){
                    case "ABCD":
                    case "X":
                        a=Math.floor(Math.random()*SetOfQuestions.length);   
                        break;
                    case "CZtoN":
                    case "NtoCZ":
                        a=Math.floor(Math.random()*CurrentVocabulary[0]);
                        break;   
                }
            }
            while(!UnusedQuestions.includes(a));
            MomentalQuestion=a;
            dvapokusy=1;
            switch(TypeOfTest){
                case "ABCD":
                    document.getElementById("nzABCD").innerHTML=SetOfQuestions[MomentalQuestion].zadaniN;
                    document.getElementById("czABCD").innerHTML=SetOfQuestions[MomentalQuestion].zadaniC;
                    document.getElementById("FrantaABCD").innerHTML=SetOfQuestions[a]["q"];
                    b=["a","1","2","3"];
                    for (let i=0;i<4;i++){
                        d=Math.floor(Math.random()*(3-i));
                        ABCDanswer[i].innerHTML=SetOfQuestions[a][b[d]];
                        b.splice(d,1);
                    };
                    break;
                case "X":
                    document.getElementById("X").focus();
                    CanUseEnter=true;
                    document.getElementById("nzX").innerHTML=SetOfQuestions[MomentalQuestion].zadaniN;
                    document.getElementById("czX").innerHTML=SetOfQuestions[MomentalQuestion].zadaniC;
                    document.getElementById("FrantaX").innerHTML=SetOfQuestions[a]["q"];
                    break;
                case "CZtoN":
                    document.getElementById("X").focus();
                    CanUseEnter=true;
                    document.getElementById("nzX").innerHTML="Schreibst du die deutsche Version des Wortes.";
                    document.getElementById("czX").innerHTML="Napi≈° nƒõmeckou verzi slov√≠ƒçka.";
                    document.getElementById("FrantaX").innerHTML=CurrentVocabulary[1][MomentalQuestion];
                    break;
                case "NtoCZ":
                    document.getElementById("X").focus();
                    CanUseEnter=true;
                    document.getElementById("nzX").innerHTML="Schreibst du die tschechische Version des Wortes.";
                    document.getElementById("czX").innerHTML="Napi≈° ƒçeskou verzi slov√≠ƒçka.";
                    document.getElementById("FrantaX").innerHTML=CurrentVocabulary[2][MomentalQuestion];
                    break;
            };
        }
        else{
            endOfTest();
        };
    };
    function tp(type,k,t,x){
        $(".Mufasa").hide();
        switch(type){
            case "ABCD":
            case "X":
                $("."+type).show();
                SetOfQuestions=NJ["lekce"+k][t][x-1];
                UnusedQuestions=Array.from({length:SetOfQuestions.length}, (_, i) => i);
                Success=Array.from({length:SetOfQuestions.length},(_,i) => 1);
                TypeOfTest=type;
                NumberForCalculationOfSuccess=0
                
                newquestion();
                break;
            case "CZtoN":
            case "NtoCZ":
            
                $(".X").show();
                UnusedQuestions=Array.from({length:CurrentVocabulary[0]}, (_, i) => i);
                Success=Array.from({length:CurrentVocabulary[0]},(_,i) => 1);
                TypeOfTest=type;
                NumberForCalculationOfSuccess=0
                newquestion();
                break;
            case "FlashCards":
                $(".FLASHCARDS").show();
                FlashcardsPreparing();
                break;
        }  
    };
    const d = document.getElementsByClassName("draggable");

    for (let i = 0; i < d.length; i++) {
        d[i].style.position = "relative";
    }

    function filter(e) {
        let target = e.target;

        if (!target.classList.contains("draggable")) {
            return;
        }

        target.moving = true;
        
        //NOTICE THIS üëá
        e.clientX ? // Check if Mouse events exist on user' device
        (target.oldX = e.clientX, // If they exist then use Mouse input
        target.oldY = e.clientY) :
        (target.oldX = e.touches[0].clientX, // otherwise use touch input
        target.oldY = e.touches[0].clientY)
        //NOTICE THIS üëÜ Since there can be multiple touches, you need to mention which touch to look for, we are using the first touch only in this case

        target.oldLeft = window.getComputedStyle(target).getPropertyValue('left').split('px')[0] * 1;
        target.oldTop = window.getComputedStyle(target).getPropertyValue('top').split('px')[0] * 1;

        document.onmousemove = dr;
        //NOTICE THIS üëá
        document.ontouchmove = dr;
        //NOTICE THIS üëÜ

        function dr(event) {
            event.preventDefault();

            if (!target.moving) {
            return;
            }
        //NOTICE THIS üëá
            event.clientX ?
            (target.distX = event.clientX - target.oldX,
            target.distY = event.clientY - target.oldY) :
            (target.distX = event.touches[0].clientX - target.oldX,
            target.distY = event.touches[0].clientY - target.oldY)
        //NOTICE THIS üëÜ

            target.style.left = target.oldLeft + target.distX + "px";
            target.style.top = target.oldTop + target.distY + "px";
        }

        function endDrag() {
            target.moving = false;
        }
        target.onmouseup = endDrag;
        //NOTICE THIS üëá
        target.ontouchend = endDrag;
        //NOTICE THIS üëÜ
    }
    document.onmousedown = filter;
    //NOTICE THIS üëá
    document.ontouchstart = filter;
    //NOTICE THIS üëÜ
</script>
{%endblock%}